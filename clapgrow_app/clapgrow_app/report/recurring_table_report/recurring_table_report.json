{
 "add_total_row": 0,
 "add_translate_data": 0,
 "columns": [],
 "creation": "2025-04-05 02:36:12.891846",
 "disabled": 0,
 "docstatus": 0,
 "doctype": "Report",
 "filters": [],
 "idx": 0,
 "is_standard": "Yes",
 "letterhead": null,
 "modified": "2025-09-06 18:40:01.760736",
 "modified_by": "Administrator",
 "module": "Clapgrow App",
 "name": "Recurring Table Report",
 "owner": "Administrator",
 "prepared_report": 0,
 "ref_doctype": "CG Task Instance",
 "report_name": "Recurring Table Report",
 "report_script": "import frappe\nfrom frappe.utils import now_datetime\n\ndef execute(filters=None):\n    columns = get_columns()\n    data = get_data()\n    return columns, data\n\ndef get_columns():\n    return [\n        {\"label\": \"Full Name\", \"fieldname\": \"full_name\", \"fieldtype\": \"Data\", \"width\": 200},\n        {\"label\": \"Email\", \"fieldname\": \"email\", \"fieldtype\": \"Data\", \"width\": 200},\n        {\"label\": \"Department\", \"fieldname\": \"department\", \"fieldtype\": \"Data\", \"width\": 150},\n        {\"label\": \"Branch\", \"fieldname\": \"branch\", \"fieldtype\": \"Data\", \"width\": 150},\n        {\"label\": \"Overdue Tasks\", \"fieldname\": \"overdue_tasks\", \"fieldtype\": \"Int\", \"width\": 120},\n        {\"label\": \"Total Tasks\", \"fieldname\": \"total_tasks\", \"fieldtype\": \"Int\", \"width\": 120},\n        {\"label\": \"Completed Tasks\", \"fieldname\": \"completed_tasks\", \"fieldtype\": \"Int\", \"width\": 120},\n        {\"label\": \"Weekly Score (%)\", \"fieldname\": \"weekly_score\", \"fieldtype\": \"Float\", \"width\": 120}\n    ]\n\ndef get_data():\n    users = frappe.get_all(\"CG User\", fields=[\"full_name\", \"email\", \"department_id\", \"branch_id\"])\n    results = []\n\n    for user in users:\n        tasks = frappe.get_all(\n            \"CG Task Instance\",\n            filters={\"assigned_to\": user[\"email\"]},\n            fields=[\"status\", \"due_date\"]\n        )\n\n        total_tasks = len(tasks)\n        completed_tasks = sum(1 for task in tasks if task[\"status\"] == \"Completed\")\n        overdue_tasks = sum(1 for task in tasks if task[\"status\"] == \"Overdue\")\n        weekly_score = (completed_tasks / total_tasks * 100) if total_tasks else 0\n\n        results.append({\n            \"full_name\": user[\"full_name\"],\n            \"email\": user[\"email\"],\n            \"department\": user[\"department_id\"],\n            \"branch\": user[\"branch_id\"],\n            \"overdue_tasks\": overdue_tasks,\n            \"total_tasks\": total_tasks,\n            \"completed_tasks\": completed_tasks,\n            \"weekly_score\": round(weekly_score, 2)\n        })\n    \n    return results",
 "report_type": "Script Report",
 "roles": [
  {
   "role": "System Manager"
  },
  {
   "role": "CG-ROLE-ADMIN"
  },
  {
   "role": "CG-ROLE-TEAM-LEAD"
  },
  {
   "role": "CG-ROLE-MEMBER"
  }
 ],
 "timeout": 0
}
